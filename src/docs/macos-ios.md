# Guide

The following is a guide for building apps on Apple's `MacOS` and `iOS`
operating systems.

## Setup

1. Sign up for a (free) [Apple Developer](https://developer.apple.com/) account.
2. Register your [devices][apple-dev-devices-add] for testing. You can use `ssc list-devices`
command to get your Device ID (UDID). Device should be connected to your mac by wire.
3. Create a wildcard [App ID][apple-dev-appid] for the application you are developing.
4. Write down your `Team ID`. It's in the top right corner of the website. You'll need this later.

## MacOS

Signing software on `MacOS` is optional but it's the best practice. Not signing
software is like using `http` instead of `https`.

### Certificate

- Open Keychain Access application on your mac (it's in Applications/Utilities).
- In the Keychain Access application choose Keychain Access -> Certificate Assistant -> Request a Certificate From a Certificate Authority...
![](../images/screenshots/prov-prof-1.png)
- Type you email in the User Email Address field. Other form elements are optional.
![](../images/screenshots/prov-prof-2.png)
- Choose Request is Saved to Disc and save your certificate request.
- [Create][apple-dev-certificates-add] a new `Developer ID Application` certificate
on the Apple Developers website.
- Choose a certificate request you've created 2 steps earlier.
- Download your certificate and double click to add it to your Keychain.

### Configuration

You will want to ensure the following fields are filled out in your `ssc.config`
file. They will look something like this...

```yaml
mac_team_id: Z3M838H537
mac_sign: Developer ID Application: Operator Tools Inc. (Z3M838H537)
```

## iOS

To run software on iOS, it must be signed by Xcode using the certificate data
contained in a "Provisioning Profile". This is a file generated by Apple and it
links `app identity`, `certificates` (used for code signing), `app permissions`,
and phystical `devices`.

### Prerequisites

- [Xcode](https://developer.apple.com/xcode/resources/) (You won't need to even open it)
- [Apple Configurator][apple-configurator] (If you want to build iOS apps)

### Certificate

- Open Keychain Access application on your mac (it's in Applications/Utilities).
- In the Keychain Access application choose Keychain Access -> Certificate Assistant -> Request a Certificate From a Certificate Authority...
![](../images/screenshots/prov-prof-1.png)
- Type you email in the User Email Address field. Other form elements are optional.
![](../images/screenshots/prov-prof-2.png)
- Choose Request is Saved to Disc and save your certificate request.
- [Create][apple-dev-certificates-add] a new iOS Distribution (App Store and Ad Hoc) certificate on the Apple Developers website.
- Choose a certificate request you've created 2 steps earlier.
- Download your certificate and double click to add it to your Keychain.

### Provisioning Profile

When you run `ssc compile --target=ios .` on your project for the first time, you may see the
following because you don't have a provisioning profile:

```
ssc compile --target=ios .
• provisioning profile not found: /Users/chicoxyzzy/dev/socketsupply/birp/./distribution.mobileprovision. Please specify a valid provisioning profile in the ios_provisioning_profile field in your `ssc.config`
```

1. [Create][apple-dev-profiles-add] a new Ad Hoc profile. Use the App ID you created with the wildcard.
1. Pick the certificate that you added to your Keychain two steps earlier.
1. Add the devices that the profile will use.
1. Add a name for your new distribution profile (we recommend to name it "distribution").
1. Download the profile and double click it. This action will open Xcode. You can close it after it's completely loaded.
1. Place your profile to your project directory (same directory as `ssc.config`). **The profiles are secret, add your profile to `.gitignore`**.

### Configuration File

1. Set the `ios_team_id` value in `ssc.config` to the value of Team ID [here][apple-dev-membership]
1. Set the `ios_distribution_method` value in `ssc.config` to the `ad-hoc`
1. Set the `ios_signing_certificate` value in `ssc.config` to the [certificate](#certificate) name as it's displayed in the Keychan
1. Set the `ios_provisioning_profile` value in `ssc.config` to the filename of your certificate (i.e., "distribution.mobileprovision").
1. Set the `ios_provisioning_specifier` value in `ssc.config` to the profile name (as in the [Profiles List][apple-dev-profiles-list])

### Simulator

```bash
ssc compile --target=iossimulator -r . # create a simulator VM and launch the app in it
```

### Distribution

```bash
ssc compile --target=ios -c -p -xd . # package for distribution
```

If macOS is asking you a password every time you run the command with `-c` flag,
follow [these instructions](/troubleshooting#macos-asks-for-password-multiple-times-on-code-signing)

### Install application on your device

Install [Apple Configurator][apple-configurator], open it and install Automation Tools from the menu.

![](../images/screenshots/prov-prof-3.png)


Connect your device and run `ssc install-app <path>` where path is the root directory of your application (the one where `ssc.config` is located).

Alternative way to install your app is to open the the `Apple Configurator` app and drag
the inner `/dist/build/[your app name].ipa/[your app name].ipa` file onto your phone.

### App Store

```bash
xcrun altool --validate-app \
  -f file \
  -t platform \
  -u username [-p password] \
  [--output-format xml]
```

```bash
xcrun altool --upload-app \
  -f file \
  -t platform \
  -u username [-p password] \
  [—output-format xml]
```

### Debugging

You can run [`lldb`][lldb] and attach to a process, for example...

```bash
process attach --name TestExample-dev
```

## Logging

To see logs on either platform, open `Console.app` (installed on MacOS by default)
and in the right side panel pick the device or computer name.

[apple-dev-membership]:https://developer.apple.com/account/#!/membership/
[apple-dev-devices-add]:https://developer.apple.com/account/resources/devices/add
[apple-dev-appid]:https://developer.apple.com/account/resources/identifiers
[app-store-connect]:https://appstoreconnect.apple.com/apps
[apple-dev-profiles-add]:https://developer.apple.com/account/resources/profiles/add
[apple-dev-certificates-add]:https://developer.apple.com/account/resources/certificates/add
[apple-dev-profiles-list]:https://developer.apple.com/account/resources/profiles/list
[lldb]:https://developer.apple.com/library/archive/documentation/IDEs/Conceptual/gdb_to_lldb_transition_guide/document/lldb-terminal-workflow-tutorial.html
[apple-configurator]:https://apps.apple.com/us/app/apple-configurator/id1037126344
